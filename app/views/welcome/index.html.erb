<script>
  $(document).ready(function() {
    function load_votes() {
      $.get('/votes/recently_added.json').success(function(data) { 
        recent_votes = new StopDisaster.Collections.Votes(data)
        view = new StopDisaster.Views.VotesIndex({collection: recent_votes})
        view.render()
        $("#recent_votes").html(view.$el.html())
      })
    }

    setInterval(function() { load_votes() }, 5000)

    $("a#new_vote").on("ajax:success", function(evt, data, status, xhr) {
      $("div.modal-body").html(data);
      $("form#new_vote").on("ajax:success", function(evt, data, status, xhr) {
        console.log("success", data)
        $("div.modal").modal("hide");
      });
      $("form#new_vote").on("ajax:error", function(evt, data, status, xhr) {
        console.log("error", data)
      });
      $("div.modal").modal("show");
    });
    $("a#new_vote").on("ajax:error", function(evt, data, status, xhr) {});

  });
</script>

<div class="row">
  <div class="col-md-3">
    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Read Appeal</h3>
      </div>
      <div class="panel-body">
        <p>
          <strong>To the Secretary-General and Secretariat of the United Nations</strong>
        </p>             
        <small>
          <p>We the undersigned addressees turn to you because of our concern at the state of the global environment. In many parts of the world the deterioration of the environment can be linked directly to social problems among the local population.</p>
          <p>Such harmful developments have accelerated and often aggravated one another. It is to be feared that this process may reach unnoticed a ‘point of no return’, after which it can no longer be reversed, or even arrested, by human intervention...</p>
        </small>
        <%= link_to "Read more", controller: "welcome", action: "appeal" %>
      </div>            
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">View Votes</h3>
      </div>
      <div class="panel-body">
        <%= link_to "Votes", controller: "votes", action: "index" %>
      </div>
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Recent Votes</h3>
      </div>
      <div class="panel-body" id="recent_votes">
        
      </div>
    </div>

  </div>
  <div class="col-md-6">
    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Join Stop Disaster!</h3>
      </div>
      <div class="panel-body">
        <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Sed posuere interdum sem. Quisque ligula eros ullamcorper quis, lacinia quis facilisis sed sapien. Mauris varius diam vitae arcu. Sed arcu lectus auctor vitae, consectetuer et venenatis eget velit. Sed augue orci, lacinia eu tincidunt et eleifend nec lacus. Donec ultricies nisl ut felis, suspendisse potenti. Lorem ipsum ligula ut hendrerit mollis, ipsum erat vehicula risus, eu suscipit sem libero nec erat. Aliquam erat volutpat. Sed congue augue vitae neque. Nulla consectetuer porttitor pede. Fusce purus morbi tortor magna condimentum vel, placerat id blandit sit amet tortor.
        </p>

        <div class="modal fade">
          <div class="modal-dialog">
          <div class="modal-header">
            <%= button_tag(type: :button, class: :close, :"data-dismiss" => "modal") do %>
              <%= "&times;".html_safe %>
            <% end %>
            <h4 class="modal-title">Add new vote</h4>
          </div>
          <div class="modal-body"></div>
      </div>
        </div>       
        <%= link_to(new_vote_path, remote: true, id: "new_vote" ) do %>
          <button class="btn btn-lg btn-success" type="button">Vote!</button>
        <% end %>
      </div>
    </div>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/PwSHOI7DwWM" frameborder="0" allowfullscreen></iframe>
  </div>

  <div class="col-md-3">
    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Discussion: Overpopulation</h3>
      </div>
      <div class="panel-body">
        <a href="https://muut.com/stopdisaster", target="top">Join discussion</a>
      </div>
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Discussion: Sahara Forestication</h3>
      </div>
      <div class="panel-body">
        <a href="https://muut.com/stopdisaster", target="top">Join discussion</a>
      </div>
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Discussion: Plastic Disaster</h3>
      </div>
      <div class="panel-body">
        <p>How did plastic garbage patches floating in the ocean become an object of public concern? Baptiste Monsaingeon relates the media campaigns that turned the gradual accumulation of oceanic waste from an abstract and imperceptible concern to a dire emergency requiring
        immediate attention.</p>
        <a href="https://muut.com/stopdisaster", target="top">Join discussion</a>
      </div>
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Discussion: Topic</h3>
      </div>
      <div class="panel-body">
        <a href="https://muut.com/stopdisaster", target="top">Join discussion</a>
      </div>
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Discussion: Topic</h3>
      </div>
      <div class="panel-body">
        <a href="https://muut.com/stopdisaster", target="top">Join discussion</a>
      </div>
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Discussion: Topic</h3>
      </div>
      <div class="panel-body">
        <a href="https://muut.com/stopdisaster", target="top">Join discussion</a>
      </div>
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Discussion: Topic</h3>
      </div>
      <div class="panel-body">
        <a href="https://muut.com/stopdisaster", target="top">Join discussion</a>
      </div>
    </div>

  </div>
</div>
